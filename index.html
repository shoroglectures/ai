<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø´Ø±ÙˆÙ‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .chat-container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 85vh;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .chat-header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .chat-header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 10px;
            background: #e7f3ff;
            border-bottom: 1px solid #b3d9ff;
            justify-content: center;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 20px;
            max-width: 75%;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            margin-left: auto;
        }
        
        .user-bubble {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 5px 20px;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        .bot-message {
            margin-right: auto;
        }
        
        .bot-bubble {
            background: white;
            color: #333;
            padding: 15px 20px;
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .message-time {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .chat-input-container {
            padding: 25px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        
        #messageInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            font-size: 16px;
            resize: none;
            height: 60px;
            max-height: 120px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        #messageInput:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        #sendButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #sendButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.4);
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .quick-btn:hover {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        @media (max-width: 768px) {
            .message {
                max-width: 85%;
            }
            
            body {
                padding: 10px;
            }
            
            .chat-container {
                height: 95vh;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p>Ø´Ø§Øª Ø°ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ© - Ù…ØªØµÙ„ Ø¨Ù€ n8n</p>
        </div>
        
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                <div class="bot-bubble">
                    <div class="message-sender">ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</div>
                    <div>ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯.</div>
                    <div style="margin-top: 10px;">ğŸ’¬ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø­Ø§Ø¯Ø«ØªÙŠ ÙÙŠ Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ³Ø£Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙˆØ±Ø§Ù‹.</div>
                    <div class="message-time" id="currentTime"></div>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="input-group">
                <textarea 
                    id="messageInput" 
                    placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." 
                    rows="1"
                ></textarea>
                <button id="sendButton">
                    <span>Ø¥Ø±Ø³Ø§Ù„</span>
                    <span>ğŸš€</span>
                </button>
            </div>
            
            <div class="quick-actions">
                <button class="quick-btn" onclick="quickMessage('Ù…Ø±Ø­Ø¨Ø§! ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ')">ğŸ‘‹ Ù…Ù‚Ø¯Ù…Ø©</button>
                <button class="quick-btn" onclick="quickMessage('Ø£Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ...')">â“ Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
                <button class="quick-btn" onclick="quickMessage('Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ù†ÙØ³Ùƒ')">ğŸ¤– Ù…Ù† Ø£Ù†Øª</button>
                <button class="quick-btn" onclick="quickMessage('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ')">ğŸ™ Ø´ÙƒØ±</button>
            </div>
        </div>
    </div>

    <script>
        class ShorogChat {
            constructor() {
                // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ IP
                this.n8nUrl = 'http://107.150.1.238:5678/webhook-test/25c6a6c6-7aca-44eb-89a3-06a32942b356';
                this.init();
            }

            init() {
                this.chatMessages = document.getElementById('chatMessages');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.statusText = document.getElementById('statusText');
                this.messageCount = 0;
                
                this.setupEventListeners();
                this.testConnection();
                this.updateCurrentTime();
                
                setInterval(() => this.updateCurrentTime(), 60000);
            }
            
            setupEventListeners() {
                this.sendButton.addEventListener('click', () => this.handleSendMessage());
                
                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.handleSendMessage();
                    }
                });
                
                this.messageInput.addEventListener('input', () => {
                    this.messageInput.style.height = 'auto';
                    this.messageInput.style.height = Math.min(this.messageInput.scrollHeight, 120) + 'px';
                });
                
                setTimeout(() => this.messageInput.focus(), 500);
            }
            
            updateCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('ar-SA', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                document.getElementById('currentTime').textContent = timeString;
            }
            
            addMessage(text, isUser = false) {
                this.messageCount++;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                
                const sender = isUser ? 'Ø£Ù†Øª' : 'ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ';
                const bubbleClass = isUser ? 'user-bubble' : 'bot-bubble';
                const time = new Date().toLocaleTimeString('ar-SA', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                messageDiv.innerHTML = `
                    <div class="${bubbleClass}">
                        <div class="message-sender">${sender}</div>
                        <div>${text}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            async testConnection() {
                this.statusText.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...';
                
                try {
                    const response = await fetch(this.n8nUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„',
                            user: 'system_test'
                        })
                    });

                    if (response.ok) {
                        this.statusText.textContent = 'âœ… Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                        this.addMessage('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†.');
                    } else {
                        throw new Error(`Ø®Ø·Ø£: ${response.status}`);
                    }
                } catch (error) {
                    this.statusText.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„';
                    this.addMessage('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ n8n.');
                    console.error('Connection test failed:', error);
                }
            }
            
            async handleSendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;

                this.addMessage(message, true);
                this.messageInput.value = '';
                this.messageInput.style.height = 'auto';
                this.sendButton.disabled = true;

                try {
                    const response = await fetch(this.n8nUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            user: 'shorog_user',
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const reply = data.reply || data.message || 'Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„ØªÙƒ!';
                        this.addMessage(reply, false);
                    } else {
                        throw new Error(`Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: ${response.status}`);
                    }
                } catch (error) {
                    this.addMessage('âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', false);
                    console.error('Send message error:', error);
                } finally {
                    this.sendButton.disabled = false;
                    this.messageInput.focus();
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
        function quickMessage(message) {
            const chat = window.chatApp;
            chat.messageInput.value = message;
            chat.handleSendMessage();
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            window.chatApp = new ShorogChat();
        });
    </script>
</body>
</html>
